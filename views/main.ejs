<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Affiliate</title>
    <link rel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous"referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  </head>
  <body>


    <div class="d-flex justify-content-end mt-2 me-3">
        <button class="btn btn-primary"
        type="button"
        data-bs-toggle="offcanvas"
        data-bs-target="#sideMenu">
  ☰ Menu
</button>

<div class="offcanvas offcanvas-end justify-content-center rounded shadow" tabindex="-1" id="sideMenu" style="width: 200px;">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">Menu</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>

  <div class="offcanvas-body">
    <ul class="list-group">
      <li class="list-group-item border-0 p-0"><button class="btn" onclick="show_personal_details_form()">Personal Details</button></li>
      <li class="list-group-item border-0 p-0"><button class="btn" onclick="show_wallet_form()">Wallet</button></li>
      <li class="list-group-item border-0 p-0"><a href="/main/transaction/<%=user.name%>/<%=user.id%>"><button class="btn">Transaction History</button></a></li>
      <li class="list-group-item border-0 p-0"><a href="/main/logout"><button class="btn">Log Out</button></a></li>
    </ul>
  </div>
</div>


    </div>

    <!-- personal details form -->
     <div id="personal_details_form"
  class="d-flex justify-content-center align-items-center d-none"
  style=" position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100%;">
    <div style="width: 400px; background-color:white;" class="rounded p-3 shadow">
        <div class="justify-content-end d-flex"><i style="cursor: pointer;" class="fa-solid fa-circle-xmark" onclick="hide_personal_details_form()"></i></div>
        <h2 class="text-center">Personal Details</h2>

        <label class="form-label mt-3"><span class="fw-semibold">Name :</span> <span><%= user.name %></span></label><br>
        <label class="form-label mt-2"><span class="fw-semibold">Email :</span> <span><%= user.email %></span></label>
        

        <label class="form-label mt-3"><span id = "set_affiliate_link" style="word-break: break-all;overflow-wrap: break-word;display: block;"></span></label>
    </div>
</div>

<!--  wallet form -->
     <div id="wallet_form"
  class="d-flex justify-content-center align-items-center d-none "
  style=" position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100%;">
    <div style="width: 400px; background-color:white;" class="rounded p-3 shadow">
        <div class="justify-content-end d-flex"><i style="cursor: pointer;" class="fa-solid fa-circle-xmark" onclick="hide_wallet_form()"></i></div>
        <h2 class="text-center">Wallet</h2>

        <label class="form-label mt-3"><span class="fw-semibold">Pending Amount :</span> <span>₹ <%= wallet.pending %></span></label><br>
        <label class="form-label mt-2"><span class="fw-semibold">Fixed Amount :</span> <span>₹ <%= wallet.fix %> </span></label>
        <label class="form-label " style="color:darkblue;"><span>Note: Only fixed Amount available for withrawal</span></label>

       <div class="w-100 text-center mt-2"> <button class="btn btn-info">Withdrawal Amount : ₹ <%= wallet.fix %> </button></div>
        

        <label class="form-label mt-3"><span id = "set_affiliate_link" style="word-break: break-all;overflow-wrap: break-word;display: block;"></span></label>
    </div>
</div>





    <div class="d-flex justify-content-center  " style="width: 100%;">
        <button class="btn btn-primary mt-5 fs-3" onclick="show_link_form()">Get Affiliate link</button>
    </div>

  <div id="link_form"
  class="d-flex justify-content-center align-items-center d-none"
  style=" position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100%;">
    <div style="width: 400px; background-color:white;" class="rounded p-3 shadow">
        <div class="justify-content-end d-flex"><i style="cursor: pointer;" class="fa-solid fa-circle-xmark" onclick="hide_link_form()"></i></div>
        <h2 class="text-center">Get your Link</h2>

        <label class="form-label mt-3">Enter your product link <span style="color:brown;">*</span></label>
        <input class="form-control mt-2 mb-2" type="text" id = "get_user_link" placeholder="Enter link">
        <div class="d-flex justify-content-center mt-4" ><button class="btn btn-secondary" id="get_link_btn">Get Affiliate link</button></div>

        <label class="form-label mt-3"><span id = "set_affiliate_link" style="word-break: break-all;overflow-wrap: break-word;display: block;"></span></label>
    </div>
</div>


    <div class="fs-4 mt-5 ms-2">How It Works - <a href="/help"><button class="btn btn-link fs-4">Click to know</button></a></div>

    <div style="width: 100%; height: 2px; background-color: black;"></div>

    <div class="d-flex justify-content-center " style="width: 100%;">
        <button class="btn btn-success mt-5 fs-3" onclick="show_order_form()">Confirm Your Order</button>
    </div>


<!-- Confirm order form -->
    <div id="order_form"
  class="d-flex justify-content-center align-items-center d-none"
  style=" position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100%;">
    <div style="width: 400px; background-color:white;" class="rounded p-3 shadow">
        <form action="/main/confirm-order/<%=user.email%>" method="post" >
            <div class="justify-content-end d-flex"><i style="cursor: pointer;" class="fa-solid fa-circle-xmark" onclick="hide_order_form()"></i></div>
        <h2 class="text-center">Confirm your order</h2>

        <label class="form-label mt-3">Enter your Order Id <span style="color:brown;">*</span></label>
        <input class="form-control mt-2 mb-2" type="text" name = "Order_Id" placeholder="Enter order Id" required>

        <label class="form-label mt-2">Enter your Order Amount <span style="color:brown;">*</span></label>
        <input class="form-control mt-2 mb-2" type="text" name = "Order_Amount" placeholder="Enter amount" required>

        <div class="d-flex justify-content-center mt-4"><button type="submit" class="btn btn-secondary">Submit</button></div>
        </form>
    </div>
</div>

<!-- show pending orders -->
<div class="container mt-5">
  <h2>Pending Orders for <%= user.name %></h2>

  <% if (orders.length === 0) { %>
    <p>No pending orders.</p>
  <% } else { %>
    <table class="table table-bordered mt-3">
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody>
        <% orders.forEach(order => { %>
          <tr>
            <td><%= order.order_id %></td>
            <td>$<%= order.amount %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } %>
</div>





    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
  <script>
  const input = document.getElementById("get_user_link");
  const output = document.getElementById("set_affiliate_link");
  const button = document.getElementById("get_link_btn");

  const AFFILIATE_ID = "gladden01-21"; 

  button.addEventListener("click", () => {
    const userLink = input.value.trim();

    if (userLink === "") {
      output.innerHTML = `<span class="text-danger">Please enter a link</span>`;
      return;
    }

    try {
      const url = new URL(userLink);

      // add / update affiliate parameter
      url.searchParams.set("tag", AFFILIATE_ID);

      output.innerHTML = `
        <strong>Your Affiliate Link:</strong><br>
        <a href="${url.toString()}" target="_blank">
          ${url.toString()}
        </a>
      `;
    } catch (err) {
      output.innerHTML = `<span class="text-danger">Please enter a valid URL</span>`;
    }
  });
// link form
  function hide_link_form(){
    document.getElementById('link_form').classList.add('d-none');
  }

  function show_link_form(){
    document.getElementById('link_form').classList.remove('d-none');
  }

    //order id form
    function hide_order_form(){
    document.getElementById('order_form').classList.add('d-none');
  }

  function show_order_form(){
    document.getElementById('order_form').classList.remove('d-none');
  }

//   personal_details_form

function hide_personal_details_form(){
    document.getElementById('personal_details_form').classList.add('d-none');
  }

  function show_personal_details_form(){
    const offcanvasEl = document.getElementById('sideMenu');

    // Create a Bootstrap Offcanvas instance
    const offcanvas = bootstrap.Offcanvas.getOrCreateInstance(offcanvasEl);

    // Hide (close) the offcanvas
    offcanvas.hide();
    document.getElementById('personal_details_form').classList.remove('d-none');
  }

  // wallet form 

  function hide_wallet_form(){
    document.getElementById('wallet_form').classList.add('d-none');
  }

  function show_wallet_form(){
    const offcanvasEl = document.getElementById('sideMenu');

    // Create a Bootstrap Offcanvas instance
    const offcanvas = bootstrap.Offcanvas.getOrCreateInstance(offcanvasEl);

    // Hide (close) the offcanvas
    offcanvas.hide();
    document.getElementById('wallet_form').classList.remove('d-none');
  }
</script>


</body>
</html>